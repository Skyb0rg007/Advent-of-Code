
lines â† âŸ¨ "467..114.."
          "...*......"
          "..35..633."
          "......#..."
          "617*......"
          ".....+.58."
          "..592....."
          "......755."
          "...$.*...."
          ".664.598.." âŸ©
# lines â†© â€¢file.Lines âŠ‘ â€¢args

arr â† âˆ¾Ë˜lines

digits â† '0'+â†•10
symMask â† 1-arrâˆŠ'.'âˆ¾digits
numMask â† arrâˆŠdigits
# Expand the symbol mask to include the spots on each side and diagonally
symMask â†© symMaskâŒˆ(Â»Ë˜symMask)âŒˆ(Â«Ë˜symMask)
symMask â†© symMaskâŒˆ(Â»symMask)âŒˆ(Â«symMask)

# Calculate a "group-mask" from a bitmask
# That maps non-digits to Â¯1, and each group of digits to an increasing index
GroupMask â† Â¬-ËœâŠ¢Ã—Â·+`Â»âŠ¸>
# groupMask AdjacentIndices symMask
AdjacentIndices â† {1â†“â·Â¯1Â»1-Ëœ(1+ğ•¨)Ã—ğ•©}
# Parse an integer
ParseNum â† 10âŠ¸Ã—âŠ¸+ËœÂ´âˆ˜âŒ½-âŸœ'0'

# Convert back to list-of-lists
symMask â†© <Ë˜symMask
gm      â† <Ë˜GroupMaskË˜ numMask
nums    â† ParseNumâš‡Â¯2 gmâŠ”Â¨<Ë˜arr

# â€¢Out "Part 1: "
# â€¢Show +Â´âˆ¾(gm AdjacentIndicesÂ¨ symMask)âŠÂ¨nums

gearMask â† arrâˆŠ"*"

# Array with each number's value in the spot of each of the digits
nums â†© âˆ¾Ë˜gm{ğ•¨âŠğ•©âˆ¾0}Â¨nums
# â€¢Show arr
# â€¢Show nums
downRight â† (1-numMask)Ã—(Â»Â»Ë˜nums)
upRight â† (1-numMask)Ã—(Â«Â»Ë˜nums)
downLeft â† (1-numMask)Ã—(Â»Â«Ë˜nums)
upLeft â† (1-numMask)Ã—(Â«Â«Ë˜nums)
up â† (1-numMask)Ã—(Â«nums)
down â† (1-numMask)Ã—(Â»nums)
left â† (1-numMask)Ã—(Â«Ë˜nums)
right â† (1-numMask)Ã—(Â»Ë˜nums)
comb â† (downRightÃ—upRight) âŒˆ (downRightÃ—downLeft) âŒˆ (downRightÃ—upLeft) âŒˆ (upRightÃ—downLeft) âŒˆ (upRightÃ—upLeft) âŒˆ (downLeft Ã— upLeft)


# â€¢Out "Part 2:"
# â€¢Show nums
# â€¢Show comb
# â€¢Show gears â† combÃ—gearMask
# â€¢Show +Â´â¥Šgears

# â€¢Show nm1 â† ((1-numMask)Ã—(Â«Ë˜nums))Ã—((1-numMask)Ã—(Â»Ë˜nums))
# â€¢Show nm2 â† ((1-numMask)Ã—(Â«nums))Ã—((1-numMask)Ã—(Â»nums))
# â€¢Show gearMask
# â€¢Show nm2Ã—gearMask
# â€¢Show (Â«Ë˜nm1)

# Expand the digit mask to include spots on each side, adding
# nmL â† (1-numMask)Ã—Â«Ë˜numMask
# nmR â† (1-numMask)Ã—Â»Ë˜numMask
# numMask â†© numMaskâŒˆnmL+nmR
# numMask â†© numMask+(Â»numMask)+(Â«numMask)
# activeGearMask â† gearMask Ã— 2=numMask

# â€¢Out "Part 2: "
# â€¢Show numMask
# â€¢Show activeGearMask
